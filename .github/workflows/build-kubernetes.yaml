name: Build Kubernetes for Multiple Architectures

on:
  workflow_dispatch:
  schedule:
    # Run monthly on the 1st at midnight
    - cron: "0 0 10 * *"
  push:
    branches:
      - main
    paths:
      - '.github/workflows/build-kubernetes.yaml'

jobs:
  # Job to determine versions to build
  get-versions:
    runs-on: ubuntu-latest
    outputs:
      k8s_tag: ${{ steps.get-versions.outputs.k8s_tag }}
      cni_version: ${{ steps.get-versions.outputs.cni_version }}
      flannel_version: ${{ steps.get-versions.outputs.flannel_version }}
    steps:
      - name: Get latest versions
        id: get-versions
        run: |
          # Get latest Kubernetes stable tag
          K8S_TAG=$(curl -s https://api.github.com/repos/kubernetes/kubernetes/tags | \
            jq -r '.[].name' | \
            grep -v -E 'alpha|beta|rc' | \
            grep '^v1\.' | \
            sort -V | \
            tail -n 1)
          
          # Get latest CNI plugins version
          CNI_VERSION=$(curl -s https://api.github.com/repos/containernetworking/plugins/releases/latest | \
            jq -r '.tag_name')
          
          # Get latest Flannel version
          FLANNEL_VERSION=$(curl -s https://api.github.com/repos/flannel-io/flannel/releases/latest | \
            jq -r '.tag_name')
          
          echo "Kubernetes version: $K8S_TAG"
          echo "CNI plugins version: $CNI_VERSION"
          echo "Flannel version: $FLANNEL_VERSION"
          
          echo "k8s_tag=$K8S_TAG" >> "$GITHUB_OUTPUT"
          echo "cni_version=$CNI_VERSION" >> "$GITHUB_OUTPUT"
          echo "flannel_version=$FLANNEL_VERSION" >> "$GITHUB_OUTPUT"

  # Build for x86_64
  build-x86:
    needs: get-versions
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            build-essential \
            git \
            rsync \
            jq \
            curl \
            wget

      - name: Check environment
        run: |
          set -eux
          uname -a
          gcc --version
          g++ --version
          ldd --version
          cat /etc/os-release

      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: 'stable'

      - name: Clone Kubernetes and checkout version
        run: |
          set -eux
          
          # Configure git for better performance
          git config --global http.postBuffer 524288000
          git config --global http.maxRequests 2
          git config --global core.compression 0
          
          # Clone Kubernetes repo
          rm -rf kubernetes
          git clone --depth=1 --no-tags https://github.com/kubernetes/kubernetes.git
          cd kubernetes
          
          # Fetch and checkout the tag
          git fetch --depth=1 origin tag ${{ needs.get-versions.outputs.k8s_tag }}
          git checkout FETCH_HEAD

      - name: Setup build environment
        run: |
          cd kubernetes
          
          # Verify Go installation
          go version
          
          # Get dependencies
          go mod download

      - name: Build Kubernetes binaries for x86_64
        run: |
          cd kubernetes
          
          echo "Building Kubernetes for linux/amd64..."
          
          KUBE_BUILD_PLATFORMS=linux/amd64 make all WHAT="cmd/kube-apiserver cmd/kube-controller-manager cmd/kube-scheduler cmd/kubelet cmd/kube-proxy cmd/kubectl cmd/kubeadm"
          
          echo "Build completed!"
          ls -lh _output/local/go/bin/ || ls -lh _output/bin/ || find _output -name "kube*" -type f

      - name: Download CNI plugins for x86_64
        run: |
          CNI_VERSION="${{ needs.get-versions.outputs.cni_version }}"
          
          echo "Downloading CNI plugins ${CNI_VERSION} for amd64..."
          wget -q "https://github.com/containernetworking/plugins/releases/download/${CNI_VERSION}/cni-plugins-linux-amd64-${CNI_VERSION}.tgz"
          
          # Extract CNI plugins
          mkdir -p cni-plugins-amd64
          tar -xzf "cni-plugins-linux-amd64-${CNI_VERSION}.tgz" -C cni-plugins-amd64/
          
          echo "CNI plugins downloaded:"
          ls -lh cni-plugins-amd64/

      - name: Build Flannel for x86_64
        run: |
          echo "Building Flannel for amd64..."
          
          # Clone Flannel
          git clone --depth=1 --branch ${{ needs.get-versions.outputs.flannel_version }} https://github.com/flannel-io/flannel.git
          cd flannel
          
          # Build flanneld
          make dist/flanneld-amd64
          
          echo "Flannel build completed:"
          ls -lh dist/

      - name: Package binaries
        run: |
          cd kubernetes
          
          # Find the output directory
          if [ -d "_output/local/go/bin" ]; then
            BIN_DIR="_output/local/go/bin"
          elif [ -d "_output/bin" ]; then
            BIN_DIR="_output/bin"
          else
            echo "ERROR: Could not find binary output directory"
            find _output -name "kubectl" -type f
            exit 1
          fi
          
          echo "Using binary directory: $BIN_DIR"
          
          # Create packaging directory structure
          mkdir -p $GITHUB_WORKSPACE/k8s-x86_64-binaries/bin
          mkdir -p $GITHUB_WORKSPACE/k8s-x86_64-binaries/cni
          mkdir -p $GITHUB_WORKSPACE/k8s-x86_64-binaries/flannel
          
          # Copy Kubernetes binaries
          cp -v $BIN_DIR/kube-apiserver $GITHUB_WORKSPACE/k8s-x86_64-binaries/bin/ || true
          cp -v $BIN_DIR/kube-controller-manager $GITHUB_WORKSPACE/k8s-x86_64-binaries/bin/ || true
          cp -v $BIN_DIR/kube-scheduler $GITHUB_WORKSPACE/k8s-x86_64-binaries/bin/ || true
          cp -v $BIN_DIR/kubelet $GITHUB_WORKSPACE/k8s-x86_64-binaries/bin/ || true
          cp -v $BIN_DIR/kube-proxy $GITHUB_WORKSPACE/k8s-x86_64-binaries/bin/ || true
          cp -v $BIN_DIR/kubectl $GITHUB_WORKSPACE/k8s-x86_64-binaries/bin/ || true
          cp -v $BIN_DIR/kubeadm $GITHUB_WORKSPACE/k8s-x86_64-binaries/bin/ || true
          
          # Copy CNI plugins
          cp -rv $GITHUB_WORKSPACE/cni-plugins-amd64/* $GITHUB_WORKSPACE/k8s-x86_64-binaries/cni/
          
          # Copy Flannel
          cp -v $GITHUB_WORKSPACE/flannel/dist/flanneld-amd64 $GITHUB_WORKSPACE/k8s-x86_64-binaries/flannel/flanneld
          
          # Create installation script
          cat > $GITHUB_WORKSPACE/k8s-x86_64-binaries/install.sh << 'EOF'
          #!/bin/bash
          set -e

          echo "Installing Kubernetes binaries..."
          sudo cp -v bin/* /usr/local/bin/
          sudo chmod +x /usr/local/bin/kube*

          echo "Installing CNI plugins..."
          sudo mkdir -p /opt/cni/bin
          sudo cp -v cni/* /opt/cni/bin/
          sudo chmod +x /opt/cni/bin/*

          echo "Installing Flannel..."
          sudo cp -v flannel/flanneld /usr/local/bin/
          sudo chmod +x /usr/local/bin/flanneld

          echo "âœ… Installation complete!"
          echo ""
          echo "Verify installation:"
          echo "  kubectl version --client"
          echo "  ls -l /opt/cni/bin"
          echo "  flanneld --version"
          EOF
          
          chmod +x $GITHUB_WORKSPACE/k8s-x86_64-binaries/install.sh
          
          # Create README
          cat > $GITHUB_WORKSPACE/k8s-x86_64-binaries/README.md << 'EOF'
          # Kubernetes with CNI and Flannel for x86_64

          This package includes:
          - Kubernetes binaries (kubectl, kubelet, kubeadm, etc.)
          - CNI plugins (for container networking)
          - Flannel (CNI network provider)
          
          ## Quick Installation
          
          ```bash
          sudo ./install.sh
          ```
          
          ## Manual Installation
          
          ### Kubernetes binaries
          ```bash
          sudo cp bin/* /usr/local/bin/
          sudo chmod +x /usr/local/bin/kube*
          ```
          
          ### CNI plugins
          ```bash
          sudo mkdir -p /opt/cni/bin
          sudo cp cni/* /opt/cni/bin/
          sudo chmod +x /opt/cni/bin/*
          ```
          
          ### Flannel
          ```bash
          sudo cp flannel/flanneld /usr/local/bin/
          sudo chmod +x /usr/local/bin/flanneld
          ```
          
          ## Container Runtime Configuration
          
          To fix the cgroupDriver warning with containerd, create/edit `/etc/containerd/config.toml`:
          
          ```toml
          version = 2
          
          [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
            runtime_type = "io.containerd.runc.v2"

            [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]
              SystemdCgroup = true
          ```
          
          Then restart containerd:
          ```bash
          sudo systemctl restart containerd
          ```
          
          For Docker, edit `/etc/docker/daemon.json`:
          ```json
          {
            "exec-opts": ["native.cgroupdriver=systemd"]
          }
          ```

          Then restart Docker:
          ```bash
          sudo systemctl restart docker
          ```
          EOF
          
          # Verify packaging
          echo "Package contents:"
          find $GITHUB_WORKSPACE/k8s-x86_64-binaries -type f
          
          # Create tarball
          tar -czf $GITHUB_WORKSPACE/kubernetes-${{ needs.get-versions.outputs.k8s_tag }}-x86_64-linux.tar.gz \
            -C $GITHUB_WORKSPACE/k8s-x86_64-binaries .
          
          echo "Archive created:"
          ls -lh $GITHUB_WORKSPACE/kubernetes-${{ needs.get-versions.outputs.k8s_tag }}-x86_64-linux.tar.gz

      - name: Upload x86_64 artifacts
        uses: actions/upload-artifact@v4
        with:
          name: kubernetes-${{ needs.get-versions.outputs.k8s_tag }}-x86_64-linux
          path: ${{ github.workspace }}/kubernetes-${{ needs.get-versions.outputs.k8s_tag }}-x86_64-linux.tar.gz

  # Build for RISC-V
  build-riscv:
    needs: get-versions
    runs-on: RISCV64
    permissions:
      contents: write
    steps:
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            build-essential \
            git \
            rsync \
            jq \
            curl \
            wget

      - name: Check environment
        run: |
          set -eux
          uname -a
          gcc --version
          g++ --version
          ldd --version
          cat /etc/os-release

      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Go
        run: |
          # Install latest stable Go
          GO_VERSION=$(curl -s https://go.dev/VERSION?m=text | head -n1)
          wget -q https://go.dev/dl/${GO_VERSION}.linux-riscv64.tar.gz
          sudo rm -rf /usr/local/go
          sudo tar -C /usr/local -xzf ${GO_VERSION}.linux-riscv64.tar.gz
          rm ${GO_VERSION}.linux-riscv64.tar.gz
          
          # Setup Go environment
          echo "export PATH=/usr/local/go/bin:\$PATH" >> $HOME/.bashrc
          echo "export GOPATH=$HOME/go" >> $HOME/.bashrc
          echo "export PATH=\$PATH:\$GOPATH/bin" >> $HOME/.bashrc
          
          # Verify installation
          /usr/local/go/bin/go version

      - name: Clone Kubernetes and checkout version
        run: |
          set -eux
          
          # Configure git for better performance
          git config --global http.postBuffer 524288000
          git config --global http.maxRequests 2
          git config --global core.compression 0
          
          # Clone Kubernetes repo
          rm -rf kubernetes
          git clone --depth=1 --no-tags https://github.com/kubernetes/kubernetes.git
          cd kubernetes
          
          # Fetch and checkout the tag
          git fetch --depth=1 origin tag ${{ needs.get-versions.outputs.k8s_tag }}
          git checkout FETCH_HEAD

      - name: Setup build environment
        run: |
          cd kubernetes
          export PATH=/usr/local/go/bin:$PATH
          export GOPATH=$HOME/go
          
          # Verify Go installation
          go version
          
          # Get dependencies
          go mod download

      - name: Build Kubernetes binaries for RISC-V
        run: |
          cd kubernetes
          export PATH=/usr/local/go/bin:$PATH
          export GOPATH=$HOME/go
          
          echo "Building Kubernetes for linux/riscv64..."
          
          KUBE_BUILD_PLATFORMS=linux/riscv64 make all WHAT="cmd/kube-apiserver cmd/kube-controller-manager cmd/kube-scheduler cmd/kubelet cmd/kube-proxy cmd/kubectl cmd/kubeadm"
          
          echo "Build completed!"
          ls -lh _output/local/go/bin/ || ls -lh _output/bin/ || find _output -name "kube*" -type f

      - name: Build CNI plugins for RISC-V
        run: |
          export PATH=/usr/local/go/bin:$PATH
          export GOPATH=$HOME/go
          
          CNI_VERSION="${{ needs.get-versions.outputs.cni_version }}"
          
          echo "Building CNI plugins ${CNI_VERSION} for riscv64..."
          
          # Clone CNI plugins
          git clone --depth=1 --branch ${CNI_VERSION} https://github.com/containernetworking/plugins.git cni-plugins
          cd cni-plugins
          
          # Build for RISC-V
          ./build_linux.sh
          
          echo "CNI plugins build completed:"
          ls -lh bin/

      - name: Build Flannel for RISC-V
        run: |
          export PATH=/usr/local/go/bin:$PATH
          export GOPATH=$HOME/go
          
          echo "Building Flannel for riscv64..."
          
          # Clone Flannel
          git clone --depth=1 --branch ${{ needs.get-versions.outputs.flannel_version }} https://github.com/flannel-io/flannel.git
          cd flannel
          
          # Build flanneld for RISC-V
          GOARCH=riscv64 make dist/flanneld
          
          echo "Flannel build completed:"
          ls -lh dist/

      - name: Package binaries
        run: |
          cd kubernetes
          
          # Find the output directory
          if [ -d "_output/local/go/bin" ]; then
            BIN_DIR="_output/local/go/bin"
          elif [ -d "_output/bin" ]; then
            BIN_DIR="_output/bin"
          else
            echo "ERROR: Could not find binary output directory"
            find _output -name "kubectl" -type f
            exit 1
          fi
          
          echo "Using binary directory: $BIN_DIR"
          
          # Create packaging directory structure
          mkdir -p $GITHUB_WORKSPACE/k8s-riscv64-binaries/bin
          mkdir -p $GITHUB_WORKSPACE/k8s-riscv64-binaries/cni
          mkdir -p $GITHUB_WORKSPACE/k8s-riscv64-binaries/flannel
          
          # Copy Kubernetes binaries
          cp -v $BIN_DIR/kube-apiserver $GITHUB_WORKSPACE/k8s-riscv64-binaries/bin/ || true
          cp -v $BIN_DIR/kube-controller-manager $GITHUB_WORKSPACE/k8s-riscv64-binaries/bin/ || true
          cp -v $BIN_DIR/kube-scheduler $GITHUB_WORKSPACE/k8s-riscv64-binaries/bin/ || true
          cp -v $BIN_DIR/kubelet $GITHUB_WORKSPACE/k8s-riscv64-binaries/bin/ || true
          cp -v $BIN_DIR/kube-proxy $GITHUB_WORKSPACE/k8s-riscv64-binaries/bin/ || true
          cp -v $BIN_DIR/kubectl $GITHUB_WORKSPACE/k8s-riscv64-binaries/bin/ || true
          cp -v $BIN_DIR/kubeadm $GITHUB_WORKSPACE/k8s-riscv64-binaries/bin/ || true
          
          # Copy CNI plugins
          cp -rv $GITHUB_WORKSPACE/cni-plugins/bin/* $GITHUB_WORKSPACE/k8s-riscv64-binaries/cni/
          
          # Copy Flannel
          cp -v $GITHUB_WORKSPACE/flannel/dist/flanneld $GITHUB_WORKSPACE/k8s-riscv64-binaries/flannel/
          
          # Create installation script
          cat > $GITHUB_WORKSPACE/k8s-riscv64-binaries/install.sh << 'EOF'
          #!/bin/bash
          set -e

          echo "Installing Kubernetes binaries..."
          sudo cp -v bin/* /usr/local/bin/
          sudo chmod +x /usr/local/bin/kube*

          echo "Installing CNI plugins..."
          sudo mkdir -p /opt/cni/bin
          sudo cp -v cni/* /opt/cni/bin/
          sudo chmod +x /opt/cni/bin/*

          echo "Installing Flannel..."
          sudo cp -v flannel/flanneld /usr/local/bin/
          sudo chmod +x /usr/local/bin/flanneld

          echo "âœ… Installation complete!"
          echo ""
          echo "Verify installation:"
          echo "  kubectl version --client"
          echo "  ls -l /opt/cni/bin"
          echo "  flanneld --version"
          EOF
          
          chmod +x $GITHUB_WORKSPACE/k8s-riscv64-binaries/install.sh
          
          # Create README
          cat > $GITHUB_WORKSPACE/k8s-riscv64-binaries/README.md << 'EOF'
          # Kubernetes with CNI and Flannel for RISC-V
              
          This package includes:
          - Kubernetes binaries (kubectl, kubelet, kubeadm, etc.)
          - CNI plugins (for container networking)
          - Flannel (CNI network provider)
          
          ## Quick Installation
          
          ```bash
          sudo ./install.sh
          ```
          
          ## Manual Installation
          
          ### Kubernetes binaries
          ```bash
          sudo cp bin/* /usr/local/bin/
          sudo chmod +x /usr/local/bin/kube*
          ```
          
          ### CNI plugins
          ```bash
          sudo mkdir -p /opt/cni/bin
          sudo cp cni/* /opt/cni/bin/
          sudo chmod +x /opt/cni/bin/*
          ```
          
          ### Flannel
          ```bash
          sudo cp flannel/flanneld /usr/local/bin/
          sudo chmod +x /usr/local/bin/flanneld
          ```
          
          ## Container Runtime Configuration
          
          To fix the cgroupDriver warning with containerd, create/edit `/etc/containerd/config.toml`:
          
          ```toml
          version = 2
          
          [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
            runtime_type = "io.containerd.runc.v2"
            
            [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]
              SystemdCgroup = true
          ```
          
          Then restart containerd:
          ```bash
          sudo systemctl restart containerd
          ```
          
          For Docker, edit `/etc/docker/daemon.json`:
          ```json
          {
            "exec-opts": ["native.cgroupdriver=systemd"]
          }
          ```
          
          Then restart Docker:
          ```bash
          sudo systemctl restart docker
          ```
          EOF
          
          # Verify packaging
          echo "Package contents:"
          find $GITHUB_WORKSPACE/k8s-riscv64-binaries -type f
          
          # Create tarball
          tar -czf $GITHUB_WORKSPACE/kubernetes-${{ needs.get-versions.outputs.k8s_tag }}-riscv64-linux.tar.gz \
            -C $GITHUB_WORKSPACE/k8s-riscv64-binaries .
          
          echo "Archive created:"
          ls -lh $GITHUB_WORKSPACE/kubernetes-${{ needs.get-versions.outputs.k8s_tag }}-riscv64-linux.tar.gz

      - name: Upload RISC-V artifacts
        uses: actions/upload-artifact@v4
        with:
          name: kubernetes-${{ needs.get-versions.outputs.k8s_tag }}-riscv64-linux
          path: ${{ github.workspace }}/kubernetes-${{ needs.get-versions.outputs.k8s_tag }}-riscv64-linux.tar.gz

  # Create release with both architectures
  create-release:
    needs: [get-versions, build-x86, build-riscv]
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Download x86_64 artifacts
        uses: actions/download-artifact@v4
        with:
          name: kubernetes-${{ needs.get-versions.outputs.k8s_tag }}-x86_64-linux
          path: ./artifacts

      - name: Download RISC-V artifacts
        uses: actions/download-artifact@v4
        with:
          name: kubernetes-${{ needs.get-versions.outputs.k8s_tag }}-riscv64-linux
          path: ./artifacts

      - name: Create or update tag
        run: |
          TAG="${{ needs.get-versions.outputs.k8s_tag }}"
          
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          if git ls-remote --exit-code --tags origin "refs/tags/$TAG" >/dev/null 2>&1; then
            echo "âœ… Tag $TAG already exists. Will update release."
          else
            echo "ğŸ†• Tag $TAG does not exist. Creating and pushing..."
            git tag "$TAG" -m "Kubernetes $TAG build for multiple architectures"
            git push origin "$TAG"
          fi

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ needs.get-versions.outputs.k8s_tag }}
          name: Kubernetes ${{ needs.get-versions.outputs.k8s_tag }} for x86_64 and RISC-V
          body: |
            # Kubernetes ${{ needs.get-versions.outputs.k8s_tag }} - Multi-Architecture Build
            
            **Unofficial** builds of Kubernetes ${{ needs.get-versions.outputs.k8s_tag }} for x86_64 and RISC-V architectures.
            
            ## ğŸ“¦ What's Included
            
            Each tarball contains:
            - **Kubernetes binaries**: kubectl, kubelet, kubeadm, kube-apiserver, kube-controller-manager, kube-scheduler, kube-proxy
            - **CNI plugins** (${{ needs.get-versions.outputs.cni_version }}): bridge, host-local, loopback, portmap, and more
            - **Flannel** (${{ needs.get-versions.outputs.flannel_version }}): Popular CNI network provider
            - **Installation script**: Automated setup with `install.sh`
            - **README**: Complete installation and configuration guide
            
            ## ğŸš€ Quick Installation
            
            ### For x86_64 (AMD64)
            
            ```bash
            # Download and extract
            wget https://github.com/${{ github.repository }}/releases/download/${{ needs.get-versions.outputs.k8s_tag }}/kubernetes-${{ needs.get-versions.outputs.k8s_tag }}-x86_64-linux.tar.gz
            tar -xzf kubernetes-${{ needs.get-versions.outputs.k8s_tag }}-x86_64-linux.tar.gz
            cd kubernetes-${{ needs.get-versions.outputs.k8s_tag }}-x86_64-linux
            
            # Install everything
            sudo ./install.sh
            
            # Verify
            kubectl version --client
            ls -l /opt/cni/bin
            ```
            
            ### For RISC-V (riscv64)
            
            ```bash
            # Download and extract
            wget https://github.com/${{ github.repository }}/releases/download/${{ needs.get-versions.outputs.k8s_tag }}/kubernetes-${{ needs.get-versions.outputs.k8s_tag }}-riscv64-linux.tar.gz
            tar -xzf kubernetes-${{ needs.get-versions.outputs.k8s_tag }}-riscv64-linux.tar.gz
            cd kubernetes-${{ needs.get-versions.outputs.k8s_tag }}-riscv64-linux
            
            # Install everything
            sudo ./install.sh
            
            # Verify
            kubectl version --client
            ls -l /opt/cni/bin
            ```
            
            ## âš™ï¸ Fixing Container Runtime Warning
            
            If you see the cgroupDriver warning during `kubeadm init`, configure your container runtime:
            
            ### For containerd
            
            Edit `/etc/containerd/config.toml`:
            
            ```toml
            version = 2
            
            [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
              runtime_type = "io.containerd.runc.v2"
              
              [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]
                SystemdCgroup = true
            ```
            
            Then restart:
            ```bash
            sudo systemctl restart containerd
            ```
            
            ### For Docker
            
            Edit `/etc/docker/daemon.json`:
            
            ```json
            {
              "exec-opts": ["native.cgroupdriver=systemd"]
            }
            ```
            
            Then restart:
            ```bash
            sudo systemctl restart docker
            ```
            
            ## ğŸ“‹ Component Versions
            
            - **Kubernetes**: ${{ needs.get-versions.outputs.k8s_tag }}
            - **CNI Plugins**: ${{ needs.get-versions.outputs.cni_version }}
            - **Flannel**: ${{ needs.get-versions.outputs.flannel_version }}
            
            ## ğŸ—ï¸ Architectures
            
            - **x86_64**: linux/amd64 (built on ubuntu-latest)
            - **RISC-V**: linux/riscv64 (built on Milk-V Pioneer)
            
            ## ğŸ“ Notes
            
            - Built from official sources without modifications
            - CNI plugins are required for pod networking
            - Flannel provides a simple overlay network
            - All binaries are statically linked where possible
            
            ## ğŸ”— Related Links
            
            - [Kubernetes Documentation](https://kubernetes.io/docs/)
            - [CNI Plugins](https://github.com/containernetworking/plugins)
            - [Flannel Documentation](https://github.com/flannel-io/flannel)
            - [Container Runtime Configuration](https://kubernetes.io/docs/setup/production-environment/container-runtimes/)
          files: |
            ./artifacts/kubernetes-${{ needs.get-versions.outputs.k8s_tag }}-x86_64-linux.tar.gz
            ./artifacts/kubernetes-${{ needs.get-versions.outputs.k8s_tag }}-riscv64-linux.tar.gz
          draft: false
          prerelease: false